# Kbuild框架概述
既然我们要来理清楚linux的整个Kbuild系统，那么就免不了要深入到每个控制编译过程的文件中，查看它们到底是如何影响整个makefile的编译过程的。   

先从一个俯瞰的角度来了解一下整个Kbuild系统的框架。  


## 参与编译的文件总览

### 控制文件

#### Top makefile
从语法和使用上和其他的子目录下makefile并无二致，为什么要单独列出来呢，因为它是一切的开始，控制着整个内核编译过程。

##### scripts/
仅仅是靠makefile的功能是很难完成整个内核的编译的，scripts/目录下有相当多的脚本对整个内核编译进行控制，其中列出几个非常重要的文件：
* Kbuild.include : 定义了常用的一系列通用变量与函数，在top Makefile开始时就被include包含，作用于整个内核的编译过程。  
* scripts/Makefile.build : 根据用户传入的参数完成真正核心的编译工作，包括编译目标的确定、递归进入子目录的编译工作等等，作用与整个内核的编译过程。   
* scripts/Makefile.lib ：负责根据用户配置或者top makefile传入的参数，对各类文件进行分类处理，以确定最后需要被编译的文件、需要递归编译的子目录，将结果赋值给相应的变量以供真正的编译程序使用。  
* scripts/link-vmlinux.sh : 对于每一个递归进入的编译目录，编译完成之后，都将在该目录下生成一个buildin.o文件，这个buildin.o文件就是由该目录下或子目录下需要编译进内核的模块打包而成，link-vmlinux.sh将这些文件统一链接起来，生成对应的镜像。  
* scripts/Makefile.host : 这个文件主要控制生成主机程序，严格来说，主机程序并不参与编译过程，它只是作为辅助，比如menuconfig的界面实现，fixdep检查工具等等。 

#### 各级子目录下的Kconfig和Makefile
linux下的Kbuild系统是一个分布式的编译系统，每个模块负责自己的编译和配置选项的提供，这种模块化的分布可以支持非常方便的移植、裁剪和维护。  

所以几乎每个目录下都存在Makefile和Kconfig文件，Makefile负责该模块下的编译工作，而Kconfig则负责该模块下的配置工作。  

### 源文件
源文件不需要过多介绍，就是参与linux内核源码编译的源代码，也是以树状结构的文件(夹)存在。

### 生成文件
在Makefile的编译过程中，将生成各类中间文件，这些中间文件各有



