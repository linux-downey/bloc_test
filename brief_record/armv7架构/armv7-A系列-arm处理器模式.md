# armv7-A系列-arm处理器模式
对于大型操作系统而言，系统安全是一个至关重要的问题，对于系统的硬件资源，应该限制应用程序直接访问，而由系统更高级别的程序进行管理，linux 和 windows 都是基于此原则实现的，这里更高级别的程序指的就是操作系统的内核。  

内核相对于应用程序自然需要拥有更高的操作权限，这种权限的区分完全由软件实现是非常困难的，需要芯片架构层面的支持。对于所有现代的处理器，几乎都会在处理器架构层面设计不同的特权等级，以适应不同的软件隔离要求。  

arm 当然也不例外，armv7-A 架构提供了 9 种工作模式：
* User：用户进程运行在 User 模式下，拥有最低的权限
* FIQ ： 快中断异常处理模式，相对于中断而言，快中断拥有更高的响应等级、更低延迟。
* IRQ ： 中断异常处理模式
* Supervisor ： 内核通常运行在该模式下，在系统复位的时候或者应用程序调用 svc 指令的时候将会进入到当前模式下，系统调用就是通过 svc 指令完成
* Abort ： 内存访问异常处理模式
* Undefined：当执行未定义的指令时，将会进入到该模式下
* System ： 系统模式，这个模式下将与用户模式共享寄存器视图
* Monotor： 针对安全扩展
* Hypervisor ： 针对虚拟化扩展

其中， User 模式处于 PL0 特权级，又被称为非特权级模式，可以访问的硬件资源十分受限，其它 8 种模式除了 hypervisor 都处于 PL1 特权级模式。普通的应用程序就是运行在user模式(PL0)下，没有对硬件的直接访问权，所有的硬件操作都需要通过系统调用向内核进行申请，内核运行在特权级模式(PL1)下，对系统调用进行响应、处理并返回，以这种隔离的方式保证了内核的安全。   

armv6 架构只有前七种工作模式，armv7 新增了安全扩展和虚拟化扩展，在系统模式上新增了两种：monitor mode 和 hypervisor mode，同时也增加了更高的特权级：PL2，hypervisor mode 就运行在 PL2 等级中，hyp mode 与虚拟化扩展相关，只有在使用虚拟化扩展功能时才进入到 hyp mode ，关于安全扩展和虚拟化扩展这里不做讨论。  









