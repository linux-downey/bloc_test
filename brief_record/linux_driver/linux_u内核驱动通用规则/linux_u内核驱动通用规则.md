# Linux 驱动开发的通用技巧
在大多数 Linux 用户的印象中，Linux 灵活且非常强大，但是换一个角度，灵活往往意味着复杂，至少对于开发者是这样的。  

是的，即使是一个 gpio 的驱动框架，原本是设置几个寄存器的事，在 Linux 中就需要做类似于 注册设备、设置回调等一系列操作，尽管 Linux 的框架尽量地将设备驱动的编写变得更简洁，将论述题变成填空题(通常一个设备驱动只需要往结构体中填充相应字段即可)。   
  
随着设备驱动的简单化，即使做再多的填空题，我们也学不会怎样去实现一个完整的驱动框架，对于工作于底层的工程师来说，这并不是一件光荣的事。  

既然要着手研究内核框架，总归是要讲究一些方法，了解内核驱动程序中一些常用的编程技巧和注意事项，通俗地说就是一些套路，这样对于我们研究内核具有战略性的作用。  

在这一章，博主就斗胆和各位讨论讨论内核框架实现中一些通用的技巧。  

## 并发性
在驱动开发之前，完全有必要了解驱动是如何工作的。  

用户通过特定的驱动接口访问硬件设备，在用户空间自然没有硬件设备的访问权限，这时候将陷入内核，由内核代为执行，然后将执行结果返回到用户空间。

而用户访问的驱动接口就是由内核驱动生成的，在用户产生访问行为且通过权限检查之后，自然就调用到相应的内核驱动程序。由此可见，驱动程序驻留在内核中更像是一种服务程序，总是被动地被调用，同时，对于大部分的接口，通常都会有并发访问的需求，比较典型的比如 磁盘的IO、网络设备。这就需要内核驱动具备处理并发的能力。  

### 可重入性
驱动代码的可重入性是第一个基本的问题，可重入代码指可被多个函数或程序调用的一段代码(通常是一个函数),而且它保证在被任何一个函数调用时都以同样的方式运行(引用自百度百科)。通俗来讲，就是程序中尽量避免全局变量、静态变量这一类在多次调用中会被当前函数修改的元素。  

在内核中是怎么做的呢？  


### 锁

## Linux 框架与回调机制






